<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Ejemplo de PWA</title>

  <!-- Ícono para la página web. Debe ponerse en la raíz de la página. -->
  <link rel="icon" sizes="32x32" href="favicon.ico">

  <!-- Color de la barra de navegación de Chrome. -->
  <meta name="theme-color" content="#ffcb2d">

  <!-- Configuración de la Web App Chrome y Microsoft Store. -->
  <link rel="manifest" href="manifest.json">

  <!-- Configuración para del acceso directo en Windows Edge/IE -->
  <!-- Icono -->
  <meta name="msapplication-TileImage" content="icono.png">
  <!-- Color de tile. -->
  <meta name="msapplication-TileColor" content="#4fc3f7">

  <!-- Configuración para Web Clip en Safari. -->
  <meta name="mobile-web-app-capable" content="yes">
  <link rel="apple-touch-icon" sizes="2048x2048" href="icono.png">
  <link rel="apple-touch-startup-image" sizes="2048x2048" href="icono.png">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">

  <link rel="stylesheet" href="estilos.css">

  <script src="/__/firebase/7.6.2/firebase-app.js"></script>
  <!-- Sarga los módulos requeridos por la aplicación sin el atributo defer.
  -->
  <script src="/__/firebase/7.6.2/firebase-auth.js"></script>
  <script src="/__/firebase/7.6.2/firebase-firestore.js"></script>
  <script src="/__/firebase/7.6.2/firebase-storage.js"></script>
  <!-- inicializa el SDK después de cargar todas las características. -->
  <script src="/__/firebase/init.js"></script>
</head>

<body>
  <h1>Ejemplo de PWA</h1>
  <p>
    <output id="mensaje">
      <progress max="100">Cargando Firebase SDK&hellip;</progress>
    </output>
  </p>
  <footer>Copyright &copy; 2020 Gilberto Pacheco Gallegos.</footer>
  <script>
    //@ts-check - indica a VS Code que valide este script.
    /* Registra un service worker para instalar la aplicación en el
     * caché del navegador. No se espera a que termine el registro y pasa a la
     * siguiente instrucción, que es "let app = firebase.app();". Cuando el
     * registro termine en un momento posterior, se invoca una de las funciones
     * registradas con then y catch. */
    navigator.serviceWorker.register("sw.js")
      /* Asigna una función que se ejecuta solo si el service worker se
       * registra correctamente. */
      .then(
        /** Función que se ejecuta solo si el service worker se registra
         * correctamente.
         * @param {ServiceWorkerRegistration} registro describe el registro. */
        registro => {
          console.log("Service Worker registrado.");
          console.log(registro);
        })
      /* Asigna una función que se ejecuta solo si se genera un error al
       * registrar el service worker. */
      .catch(muestraError);
    try {
      // @ts-ignore
      let app = firebase.app();
      let features = ["auth", "firestore", "storage"]
        .filter(feature => typeof app[feature] === "function");
      // @ts-ignore
      mensaje.value = `Firebase SDK cargó con: ${features.join(', ')}`;
    } catch (e) {
      muestraError(e);
    }
    /** Procesa una excepción y muestra un mensaje de error.
     * @param {Error} e descripción del error. */
    function muestraError(e) {
      console.log(e);
      // @ts-ignore
      mensaje.value = e.message;
    }
  </script>
</body>

</html>